local currentScriptSource = [=[local selfUpdateUrl = "https://raw.githubusercontent.com/SUUUUUS00000/Best-Fps-Booster/refs/heads/main/Best%20Fps%20Booster"
local updateCheckInterval = 300

local Z,G,S,V,P,U;S,G,P,V,U={},game,pairs,Vector3.new,CFrame.new;local function dec(t)local r,c,b={},string.char,bit32.bxor;for i=1,#t do r[i]=c(b(t[i],17))end;return table.concat(r)end;local srv={dec{114,117,110,115,101,114,118,105,99,101},dec{99,111,108,108,101,99,116,105,111,110,115,01,114,118,105,99,101},dec{119,111,114,107,115,112,97,99,101},dec{115,116,97,116,115},dec{108,105,103,104,116,105,110,103},dec{99,111,110,116,101,110,116,112,114,111,118,105,100,101,114},dec{117,115,101,114,103,97,109,101,115,101,116,116,105,110,103,115},dec{112,104,121,115,105,99,115,101,114,118,105,99,101},dec{112,108,97,121,101,114,115},dec{104,116,116,112,115,101,114,118,105,99,101}};local s1,s2,s3,s4,s5,s6,s7,s8,s9,s10=G:GetService(srv[1]),G:GetService(srv[2]),G:GetService(srv[3]),G:GetService(srv[4]),G:GetService(srv[5]),G:GetService(srv[6]),UserSettings():GetService(srv[7]),G:GetService(srv[8]),G:GetService(srv[9]),G:GetService(srv[10]);local cam,clk,ins,rem,cln,flr,inf,ex,mn,mx,clmp=s3.CurrentCamera,os.clock,table.insert,table.remove,table.clone,math.floor,math.huge,math.exp,math.min,math.max,math.clamp;local ip,pc,sp,wt,dl,cr,rs=ipairs,pcall,task.spawn,task.wait,task.delay,coroutine.create,coroutine.resume;local l_gfp=cam.GetFrustumPlanes;Z.U={};function Z.U.iV(p,bS)local f,bP=l_gfp(cam),p.Position;for i=1,6 do local pl=f[i];local d=pl.Normal:Dot(bP)-pl.Offset;local r=bS.X*math.abs(pl.Normal.X)+bS.Y*math.abs(pl.Normal.Y)+bS.Z*math.abs(pl.Normal.Z);if d<-r then return false end end;return true end;Z._M1={PROFS={[1]={f=100,p=60,m=2000},[2]={f=60,p=55,m=1200},[3]={f=45,p=40,m=1000},[4]={f=35,p=25,m=600}},aggr={r=2,p=2,e=2,d=2,c=2,init=2},_avgFps=60,_prevFps=60,_lastCheck=0,_isCalibrated=true,_state="Normal",_cdStart=0,BASE_CD_DUR=6,BASE_REC_DUR=6,REC_FPS=60,EMG_FPS=35};function Z._M1:f1(s)if self._state==s then return end;self._state=s;if s=="Emergency"then for k,_ in P(self.aggr)do self.aggr[k]=5 end;elseif s=="Cooldown"then self._cdStart=clk()elseif s=="Normal"then local sA,e,d=cln(self.aggr),0,mn(self.BASE_REC_DUR * 2, mx(1, flr(self.BASE_REC_DUR * (1 + (self.aggr.c - 1) / 4))));sp(function()while e<d and self._state=="Normal"do local a=e/d;for k,v in P(sA)do self.aggr[k]=v+(2-v)*a end;e+=s1.Heartbeat:Wait()end;end)end end;function Z._M1:f2(dt)local e=ex(-dt*3);self._avgFps=e*self._avgFps+(1-e)*(1/dt)if not self._isCalibrated then return end;local s,af=self._state,self._avgFps;if s=="Normal"then if af<self.EMG_FPS or af<self._prevFps*0.65 then self:f1("Emergency")end elseif s=="Emergency"then if af>self.REC_FPS then self:f1("Cooldown")end elseif s=="Cooldown"then if af<self.EMG_FPS then self:f1("Emergency")elseif clk()-self._cdStart>mn(self.BASE_CD_DUR * 2, mx(1, flr(self.BASE_CD_DUR * (1 + (self.aggr.c - 1) / 4)))) then self:f1("Normal")end end;self._prevFps=af;if s~="Normal"then return end;local n=clk()if n-self._lastCheck<0.5 then return end;self._lastCheck=n;local pr,ag=self.PROFS,self.aggr;local p=pr[4];if af>pr[2].f then p=pr[1]elseif af>pr[3].f then p=pr[2]else p=pr[3]end;local rs,ps,ms=af/p.f,s3:GetRealPhysicsFPS()/p.p,p.m/s4.Total.Value;local a=0.5;local nr,np,ne,nd,nc,ninit=rs<0.9 and(rs<0.7 and 3 or 2)or 1,ps<0.9 and(ps<0.7 and 4 or 3)or 1,(rs<1 or ms<1)and(rs<0.8 or ms<0.8 and 4 or 3)or 1,rs<0.9 and(rs<0.75 and 4 or 3)or 1,p==pr[4]and 3 or p==pr[3]and 2 or 1,(rs<1 or ms<1)and(rs<0.8 or ms<0.8 and 4 or 3)or 1;ag.r=ag.r+(nr-ag.r)*a;ag.p=ag.p+(np-ag.p)*a;ag.e=ag.e+(ne-ag.e)*a;ag.d=ag.d+(nd-ag.d)*a;ag.c=ag.c+(nc-ag.c)*a;ag.init=ag.init+(ninit-ag.init)*a;end;Z._M2={SIM_THRESH=10,PART_THRESH=30,FX_THRESH=3,_scanIndex=1,_scanChildren=nil,SCAN_BATCH_SIZE=8};function Z._M2:f1()local tags={"ManagedRender","ManagedEffect","Clutter"};local function pr(m)local pC,eC=0,0;for _,d in ip(m:GetDescendants())do if d:IsA("BasePart")then pC+=1 elseif d:IsA("ParticleEmitter")or d:IsA("Light")then eC+=1 end end;if pC>self.PART_THRESH and not s2:HasTag(m,tags[1])then s2:AddTag(m,tags[1])end;if eC>self.FX_THRESH and not s2:HasTag(m,tags[2])then s2:AddTag(m,tags[2])end end;if not self._scanChildren then self._scanChildren=s3:GetChildren();self._scanIndex=1 end;local baseScanBatchSize = self.SCAN_BATCH_SIZE;local currentScanBatchSize = mn(baseScanBatchSize * 2, mx(1, flr(baseScanBatchSize * (1 + (Z._M1.aggr.init - 1) / 4))));local processedCount=0;while self._scanIndex<=#self._scanChildren and processedCount<currentScanBatchSize do local i=self._scanChildren[self._scanIndex];if i:IsA("Model")and i.PrimaryPart then pr(i)elseif i:IsA("MeshPart")then local k=i.MeshId;if k~=""then Z._M2.s=Z._M2.s or {};Z._M2.s[k]=Z._M2.s[k]or{c=0,i={}};Z._M2.s[k].c+=1;ins(Z._M2.s[k].i,i)end end;self._scanIndex+=1;processedCount+=1 end;if self._scanIndex>#self._scanChildren then local s=Z._M2.s;if s then for _,d in P(s)do if d.c>self.SIM_THRESH then for _,o in ip(d.i)do if not s2:HasTag(o,tags[3])then s2:AddTag(o,tags[3])end end end end end;self._scanChildren=nil;self._scanIndex=1 end end;Z._M4={_tasks={}};function Z._M4:f1(t)local c=cr(function()while true do pc(t.fn,t.args or{})local a=Z._M1.aggr[t.cat]or 1;wt(t.int*a)end end);ins(self._tasks,c)end;function Z._M4:f2()for _,c in ip(self._tasks)do rs(c)end end;Z._M5={BASE_GRID_SIZE=250,_grid={},_tracked=setmetatable({},{__mode="k"})};function Z._M5:f1(o,d)if not(o and o:IsA("BasePart"))then return end;local s=self.BASE_GRID_SIZE;local p=o.Position;local k=flr(p.X/s).." "..flr(p.Y/s).." "..flr(p.Z/s);self._grid[k]=self._grid[k]or{};ins(self._grid[k],o);self._tracked[o]={c=k,d=d}end;function Z._M5:f2(p,r)local res={};local s=mn(self.BASE_GRID_SIZE * 5, mx(50, flr(self.BASE_GRID_SIZE * Z._M1.aggr.r)));local cR=flr(r/s)+1;local cx,cy,cz=flr(p.X/s),flr(p.Y/s),flr(p.Z/s);for i=cx-cR,cx+cR do for j=cy-cR,cy+cR do for k=cz-cR,cz+cR do local c=self._grid[i.." "..j.." "..k];if c then for _,o in ip(c)do ins(res,o)end end end end end;return res end;Z._M6={DIST_SQR={[1]={14400,90000,360000},[2]={6400,40000,202500},[3]={3000,30000,120000},[4]={2000,15000,60000},[5]={900,4000,15000}},_culled={},_rQ={_h=1,_t=1}};function Z._M6:f1(m)if not m.PrimaryPart then return end;local p={};local bS=V();for _,d in ip(m:GetDescendants())do if d:IsA("BasePart")then ins(p,d);bS=bS+d.Size end end;local bSz=m:GetBoundingBox();Z._M5:f1(m.PrimaryPart,{LOD={p=p,m=m,lf=-1,lt=0,isC=false,bS=bSz.Size,fT=1}})m.Destroying:Connect(function()for i=#self._culled,1,-1 do if self._culled[i].o==m then rem(self._culled,i)break end end end)end;function Z._M6:f2(cf)local a=flr(Z._M1.aggr.r+0.5);local l,cP=clmp(a,1,5),cf.Position;local lSqr=self.DIST_SQR[l];local baseRenderRadius = 800;local currentRenderRadius = mn(baseRenderRadius * 2, mx(50, flr(baseRenderRadius * (1 + (Z._M1.aggr.r - 1) / 4))));local nby=Z._M5:f2(cP,currentRenderRadius);for _,pP in ip(nby)do local t=Z._M5._tracked[pP];if not(pP and pP.Parent and t and t.d.LOD)then continue end;local ld=t.d.LOD;if ld.isC then continue end;local dSqr=(pP.Position-cP).MagnitudeSqr;if not Z.U.iV(pP,ld.bS)and dSqr>lSqr[2]then ld.isC=true;ins(self._culled,{o=ld.m,p=ld.m.Parent,d=ld});ld.m.Parent=nil;if ld.m.PrimaryPart then ld.m.PrimaryPart:SetNetworkOwner(nil)end;else local nT,nF;if dSqr<lSqr[1]then nT,nF=0,0
elseif dSqr<lSqr[2]then nT,nF=0.75,1
else nT,nF=1,2 end;
if ld.lt~=nT then for _,part in ip(ld.p)do part.LocalTransparencyModifier=nT end;ld.lt=nT end;if ld.lf~=nF then local rf=Enum.RenderFidelity.FromValue(nF);for _,part in ip(ld.p)do part.RenderFidelity=rf end;ld.lf=nF end end end end;function Z._M6:f3(cf)local a=flr(Z._M1.aggr.r+0.5);local l=clmp(a,1,5);local dSqr=self.DIST_SQR[l][2]*1.2;for i=#self._culled,1,-1 do local cE=self._culled[i];local pP=cE.o.PrimaryPart;if not pP then rem(self._culled,i);continue end;if Z.U.iV(pP,cE.d.bS)and(pP.Position-cf.Position).MagnitudeSqr<dSqr then local q=self._rQ;q[q._t]=cE;q._t+=1;rem(self._culled,i)end end end;function Z._M6:f4()local q=self._rQ;local baseMaxProcess=3;local currentMaxProcess=mn(baseMaxProcess * 2, mx(1, flr(baseMaxProcess * (1 + (Z._M1.aggr.r - 1) / 4))));local processedThisFrame=0;while q._h<q._t and processedThisFrame<currentMaxProcess do local r=q[q._h];q[q._h]=nil;q._h+=1;if r and r.o and r.p then r.o.Parent=r.p;if r.o.PrimaryPart then r.o.PrimaryPart:SetNetworkOwner(s9.LocalPlayer)end;if r.d then r.d.isC=false;local d=r.d;sp(function()local s,e=1,d.lt or 0;local t=0.3;local st=clk();while clk()-st<t do local a=(clk()-st)/t;for _,pt in ip(d.p)do pt.LocalTransparencyModifier=s+(e-s)*a end;wt()end;for _,pt in ip(d.p)do pt.LocalTransparencyModifier=e end end)end;end;processedThisFrame+=1;end;if q._h>10 then q._h=1;q._t=1 end end;Z._M7={DIST_SQR={[1]=inf,[2]=62500,[3]=30000,[4]=6000,[5]=1000},SLEEP_VEL=0.25};function Z._M7:f1(m)if not m.PrimaryPart then return end;local p={};for _,d in ip(m:GetDescendants())do if d:IsA("BasePart")and not d.Anchored then ins(p,d)end end;if #p>0 then Z._M5:f1(m.PrimaryPart,{Physics={p=p}})end;end;function Z._M7:f2(cP)local a=flr(Z._M1.aggr.p+0.5);local l=clmp(a,1,5);local dSqr=self.DIST_SQR[l];local basePhysicsRadius = 500;local currentPhysicsRadius = mn(basePhysicsRadius * 2, mx(50, flr(basePhysicsRadius * (1 + (Z._M1.aggr.p - 1) / 4))));local nby=Z._M5:f2(cP,currentPhysicsRadius);for _,pP in ip(nby)do local t=Z._M5._tracked[pP];if not(pP and pP.Parent and t and t.d.Physics)then continue end;local sA=(pP.Position-cP).MagnitudeSqr>dSqr or pP.AssemblyLinearVelocity.Magnitude<self.SLEEP_VEL;for _,p in ip(t.d.Physics.p)do if p and p.Anchored~=sA then p.Anchored=sA;if sA then p:SetNetworkOwner(nil);else p:SetNetworkOwner(s9.LocalPlayer);end end end end end;Z._M8={DIST_CULL={[1]=500,[2]=300,[3]=150,[4]=60,[5]=30},FADE_START_DIST=100,FADE_END_DIST=400,_effects={}};function Z._M8:f1(i)local aP=i:IsA("BasePart")and i or i:FindFirstAncestorWhichIsA("Model")and i:FindFirstAncestorWhichIsA("Model").PrimaryPart;if not aP then return end;local function pE(e)local d={e=e,a=aP,o={},c={}};if e:IsA("ParticleEmitter")then d.o.Rate=e.Rate;d.c.Rate=e.Rate elseif e:IsA("Light")then d.o.Brightness=e.Brightness;d.c.Brightness=e.Brightness elseif e:IsA("Beam")then d.o.Width0=e.Width0;d.o.Width1=e.Width1;d.c.Width0=e.Width0;d.c.Width1=e.Width1 elseif e:IsA("Trail")then d.o.Lifetime=e.Lifetime;d.c.Lifetime=e.Lifetime end;ins(self._effects,d)e.Destroying:Connect(function()for idx=#self._effects,1,-1 do if self._effects[idx].e==e then rem(self._effects,idx)break end end end)end;if i:IsA("ParticleEmitter")or i:IsA("Beam")or i:IsA("Trail")or i:IsA("Light")then pE(i)else for _,d in ip(i:GetDescendants())do if d:IsA("ParticleEmitter")or d:IsA("Beam")or d:IsA("Trail")or d:IsA("Light")then pE(d)end end end end;function Z._M8:f3(cf)local a=flr(Z._M1.aggr.e+0.5);local l=clmp(a,1,5);local cD_sq=self.DIST_CULL[l]*self.DIST_CULL[l];local cP=cf.Position;for _,d in ip(self._effects)do local e,aP=d.e,d.a;if not(e and e.Parent and aP and aP.Parent)then continue end;local dSqr_effect=(aP.Position-cP).MagnitudeSqr;local targetEnabled=Z.U.iV(aP,aP.Size)and dSqr_effect<cD_sq;local fadeFactor=1;local FADE_START_DSQR=self.FADE_START_DIST*self.FADE_START_DIST;local FADE_END_DSQR=self.FADE_END_DIST*self.FADE_END_DIST;if dSqr_effect>FADE_START_DSQR then fadeFactor=1-clmp((dSqr_effect-FADE_START_DSQR)/(FADE_END_DSQR-FADE_END_DSQR),0,1)end;if e:IsA("ParticleEmitter")then e.Rate=d.o.Rate*fadeFactor elseif e:IsA("Light")then e.Brightness=d.o.Brightness*fadeFactor elseif e:IsA("Beam")then e.Width0=d.o.Width0*fadeFactor;e.Width1=d.o.Width1*fadeFactor elseif e:IsA("Trail")then e.Lifetime=d.o.Lifetime*fadeFactor end;if e.Enabled~=(targetEnabled and fadeFactor>0.01)then e.Enabled=(targetEnabled and fadeFactor>0.01)end end end;Z._M9={CULL_PCNT={[1]=0,[2]=0.35,[3]=0.6,[4]=0.75,[5]=0.9},DIST_START=250,_culled={},_clutter={}};function Z._M9:f1(i)local pP=i:IsA("Model")and i.PrimaryPart or(i:IsA("BasePart")and i);if pP then ins(self._clutter,{i=i,pP=pP,isC=false})i.Destroying:Connect(function()for idx=#self._clutter,1,-1 do if self._clutter[idx].i==i then rem(self._clutter,idx)break end end end)end;end;function Z._M9:f2(cP)local a=flr(Z._M1.aggr.d+0.5);local l=clmp(a,1,5);local cPcnt=self.CULL_PCNT[l];local baseMaxProcess=3;local currentMaxProcess=mn(baseMaxProcess * 2, mx(1, flr(baseMaxProcess * (1 + (Z._M1.aggr.d - 1) / 4))));if cPcnt==0 then self:f4()return end;local pTC={};for _,cD in ip(self._clutter)do if not cD.isC and(cD.pP.Position-cP).Magnitude>self.DIST_START then ins(pTC,cD)end end;local processedCount=0;for i=1,flr(#pTC*cPcnt)do if processedCount>=currentMaxProcess then break end;local cD=pTC[i];if not cD.isC then cD.isC=true;ins(self._culled,{o=cD.i,p=cD.i.Parent,d=cD});cD.i.Parent=nil;if cD.pP then cD.pP:SetNetworkOwner(nil)end;end;processedCount+=1;end;function Z._M9:f3(cP)for i=#self._culled,1,-1 do local e=self._culled[i];if not e.o or not e.o.PrimaryPart then rem(self._culled,i);continue end;if(e.d.pP.Position-cP).Magnitude<self.DIST_START*0.9 then e.d.isC=false;e.o.Parent=e.p;if e.d.pP then e.d.pP:SetNetworkOwner(s9.LocalPlayer)end;rem(self._culled,i)end end end;function Z._M9:f4()for i=#self._culled,1,-1 do local e=self._culled[i];if not e.o or not e.o.PrimaryPart then rem(self._culled,i)continue end;e.d.isC=false;e.o.Parent=e.p;if e.d.pP then e.d.pP:SetNetworkOwner(s9.LocalPlayer)end;rem(self._culled,i)end end;Z._M13={_trackedScripts={},_checkIndex=1,BASE_CHECK_BATCH_SIZE=2,DIST_THRESHOLD=200};function Z._M13:f1(instance)if not instance then return end;if s2:HasTag(instance,"ManagedScriptActivity")then for _,script in ip(instance:GetDescendants())do if script:IsA("Script")or script:IsA("LocalScript")then ins(self._trackedScripts,script)script.Destroying:Connect(function()for idx=#self._trackedScripts,1,-1 do if self._trackedScripts[idx]==script then rem(self._trackedScripts,idx)break end end end)end end end end;function Z._M13:f2(cP)local baseBatchSize=self.BASE_CHECK_BATCH_SIZE;local currentBatchSize=mn(baseBatchSize * 2, mx(1, flr(baseBatchSize * (1 + (Z._M1.aggr.c - 1) / 4))));local baseDistThreshold = self.DIST_THRESHOLD;local currentDistThreshold = mn(baseDistThreshold * 2, mx(50, flr(baseDistThreshold * (1 + (Z._M1.aggr.c - 1) / 4))));local processedCount=0;while self._checkIndex<=#self._trackedScripts and processedCount<currentBatchSize do local script=self._trackedScripts[self._checkIndex];if not script or not script.Parent then rem(self._trackedScripts,self._checkIndex);goto continue end;local targetPart=script.Parent:IsA("BasePart")and script.Parent or script.Parent:FindFirstAncestorWhichIsA("BasePart");if targetPart then local distSqr=(targetPart.Position-cP).MagnitudeSqr;local shouldBeDisabled=distSqr>(currentDistThreshold*currentDistThreshold);if script.Disabled~=shouldBeDisabled then script.Disabled=shouldBeDisabled end end;self._checkIndex+=1;processedCount+=1;::continue:: end;if self._checkIndex>#self._trackedScripts then self._checkIndex=1 end end;Z._newInstancesQueue={};function Z:processNewInstancesQueue()local baseBatchSize=2;local currentBatchSize=mn(baseBatchSize * 2, mx(1, flr(baseBatchSize * (1 + (Z._M1.aggr.init - 1) / 4))));local processedCount=0;while #self._newInstancesQueue > 0 and processedCount < currentBatchSize do local i=rem(self._newInstancesQueue,1);if not i then continue end;if s2:HasTag(i,"ManagedRender")then Z._M6:f1(i)end;if s2:HasTag(i,"ManagedPhysics")then Z._M7:f1(i)end;if s2:HasTag(i,"ManagedEffect")then Z._M8:f1(i)end;if s2:HasTag(i,"Clutter")then Z._M9:f1(i)end;Z._M13:f1(i);processedCount+=1 end end;Z._M14={_cacheList={},_currentCacheIndex=1,_currentEntryIndex=1,CLEAN_BATCH_SIZE=5,_compactThreshold=50};Z._M14._cacheList={Z._M6._culled,Z._M8._effects,Z._M9._culled,Z._M9._clutter,Z._M13._trackedScripts};function Z._M14:f1()local currentCache=self._cacheList[self._currentCacheIndex];if not currentCache then return end;local baseCleanBatchSize=self.CLEAN_BATCH_SIZE;local currentCleanBatchSize=mn(baseCleanBatchSize * 2, mx(1, flr(baseCleanBatchSize * (1 + (Z._M1.aggr.c - 1) / 4))));local processedCount=0;local markedForRemovalCount=0;local initialEntryIndex=self._currentEntryIndex;for i=initialEntryIndex,#currentCache do if processedCount>=currentCleanBatchSize then break end;local entry=currentCache[i];local instanceToCheck=nil;if currentCache==Z._M6._culled then instanceToCheck=entry.o elseif currentCache==Z._M8._effects then instanceToCheck=entry.e elseif currentCache==Z._M9._culled then instanceToCheck=entry.o elseif currentCache==Z._M9._clutter then instanceToCheck=entry.i elseif currentCache==Z._M13._trackedScripts then instanceToCheck=entry end;if not instanceToCheck or not instanceToCheck.Parent or not instanceToCheck:IsDescendantOf(game)then currentCache[i]=nil;markedForRemovalCount+=1 end;if currentCache==Z._M5._tracked and entry and entry.d and entry.d.LOD and not (instanceToCheck and instanceToCheck.Parent and instanceToCheck:IsDescendantOf(game) and instanceToCheck.Parent:IsA("Model") and instanceToCheck.Parent.PrimaryPart == instanceToCheck) then currentCache[i]=nil;markedForRemovalCount+=1 end;processedCount+=1;self._currentEntryIndex=i+1 end;if markedForRemovalCount>0 and (markedForRemovalCount>=self._compactThreshold or self._currentEntryIndex>#currentCache) then local newCache={};local newIndex=1;for _,entry in ip(currentCache)do if entry~=nil then newCache[newIndex]=entry;newIndex+=1 end end;for k,v in P(currentCache)do currentCache[k]=nil end;for i=1,newIndex-1 do currentCache[i]=newCache[i]end;self._currentEntryIndex=1;end;if self._currentCacheIndex>#currentCache or #currentCache==0 then self._currentCacheIndex=self._currentCacheIndex+1;self._currentCacheIndex=1;if self._currentCacheIndex>#self._cacheList then self._currentCacheIndex=1 end end end;Z._scriptManager={_runningScripts={}};function Z._scriptManager:loadAndRun(url)local success,code=pc(s10.GetAsync,s10,url);if not success then return end;local func,err=loadstring(code);if not func then return end;local co=cr(func);self._runningScripts[url]=co;rs(co);end;function Z._scriptManager:stopScript(url)local co=self._runningScripts[url];if co and rs(co,"yield")then self._runningScripts[url]=nil;end;end;local function performSelfUpdateCheck()local success,newCode=pc(s10.GetAsync,s10,selfUpdateUrl);if success and newCode then if newCode~=currentScriptSource then print("Оптимизатор: Обнаружено новое обновление. Загрузка новой версии...");local loadedFunc,err=loadstring(newCode);if loadedFunc then sp(loadedFunc);while true do task.wait(9e9)end else print("Оптимизатор: Ошибка загрузки нового скрипта: "..err);end else print("Оптимизатор: Скрипт актуален.");end else print("Оптимизатор: Ошибка при проверке обновления: "..(newCode or "Неизвестная ошибка"));end end;task.delay(updateCheckInterval,function()while true do performSelfUpdateCheck();task.wait(updateCheckInterval)end end);function Z:Activate()sp(self._M2.f1,self);local function pr(i)if not i then return end;ins(Z._newInstancesQueue,i)end;local tags={"ManagedRender","ManagedPhysics","ManagedEffect","Clutter","ManagedScriptActivity"};for _,t in ip(tags)do for _,i in ip(s2:GetTagged(t))do pr(i)end;s2:GetInstanceAddedSignal(t):Connect(pr)end;self._M4:f1({fn=function()Z._M1:f2(s1.Heartbeat:Wait())end,int=0,cat="c"});local cf;self._M4:f1({fn=function()cf=cam.CFrame;Z._M6:f2(cf);Z._M7:f2(cf.Position);Z._M8:f3(cf);Z._M9:f2(cf.Position);Z._M13:f2(cf.Position)end,int=0.12,cat="c"});self._M4:f1({fn=function()cf=cam.CFrame;Z._M6:f3(cf);Z._M9:f3(cf.Position);Z._M6:f4()end,int=0.1,cat="r"});self._M4:f1({fn=function()Z:processNewInstancesQueue()end,int=0.15,cat="init"});self._M4:f1({fn=function()Z._M14:f1()end,int=mn(10, mx(1, flr(5 / Z._M1.aggr.c))),cat="init"});Z._M4:f2()end;Z:Activate()]=]
local selfUpdateUrl = "https://raw.githubusercontent.com/SUUUUUS00000/Best-Fps-Booster/refs/heads/main/Best%20Fps%20Booster"
local updateCheckInterval = 300

local Z,G,S,V,P,U;S,G,P,V,U={},game,pairs,Vector3.new,CFrame.new;local function dec(t)local r,c,b={},string.char,bit32.bxor;for i=1,#t do r[i]=c(b(t[i],17))end;return table.concat(r)end;local srv={dec{114,117,110,115,101,114,118,105,99,101},dec{99,111,108,108,101,99,116,105,111,110,115,01,114,118,105,99,101},dec{119,111,114,107,115,112,97,99,101},dec{115,116,97,116,115},dec{108,105,103,104,116,105,110,103},dec{99,111,110,116,101,110,116,112,114,111,118,105,100,101,114},dec{117,115,101,114,103,97,109,101,115,101,116,116,105,110,103,115},dec{112,104,121,115,105,99,115,101,114,118,105,99,101},dec{112,108,97,121,101,114,115},dec{104,116,116,112,115,101,114,118,105,99,101}};local s1,s2,s3,s4,s5,s6,s7,s8,s9,s10=G:GetService(srv[1]),G:GetService(srv[2]),G:GetService(srv[3]),G:GetService(srv[4]),G:GetService(srv[5]),G:GetService(srv[6]),UserSettings():GetService(srv[7]),G:GetService(srv[8]),G:GetService(srv[9]),G:GetService(srv[10]);local cam,clk,ins,rem,cln,flr,inf,ex,mn,mx,clmp=s3.CurrentCamera,os.clock,table.insert,table.remove,table.clone,math.floor,math.huge,math.exp,math.min,math.max,math.clamp;local ip,pc,sp,wt,dl,cr,rs=ipairs,pcall,task.spawn,task.wait,task.delay,coroutine.create,coroutine.resume;local l_gfp=cam.GetFrustumPlanes;Z.U={};function Z.U.iV(p,bS)local f,bP=l_gfp(cam),p.Position;for i=1,6 do local pl=f[i];local d=pl.Normal:Dot(bP)-pl.Offset;local r=bS.X*math.abs(pl.Normal.X)+bS.Y*math.abs(pl.Normal.Y)+bS.Z*math.abs(pl.Normal.Z);if d<-r then return false end end;return true end;Z._M1={PROFS={[1]={f=100,p=60,m=2000},[2]={f=60,p=55,m=1200},[3]={f=45,p=40,m=1000},[4]={f=35,p=25,m=600}},aggr={r=2,p=2,e=2,d=2,c=2,init=2},_avgFps=60,_prevFps=60,_lastCheck=0,_isCalibrated=true,_state="Normal",_cdStart=0,BASE_CD_DUR=6,BASE_REC_DUR=6,REC_FPS=60,EMG_FPS=35};function Z._M1:f1(s)if self._state==s then return end;self._state=s;if s=="Emergency"then for k,_ in P(self.aggr)do self.aggr[k]=5 end;elseif s=="Cooldown"then self._cdStart=clk()elseif s=="Normal"then local sA,e,d=cln(self.aggr),0,mn(self.BASE_REC_DUR * 2, mx(1, flr(self.BASE_REC_DUR * (1 + (self.aggr.c - 1) / 4))));sp(function()while e<d and self._state=="Normal"do local a=e/d;for k,v in P(sA)do self.aggr[k]=v+(2-v)*a end;e+=s1.Heartbeat:Wait()end;end)end end;function Z._M1:f2(dt)local e=ex(-dt*3);self._avgFps=e*self._avgFps+(1-e)*(1/dt)if not self._isCalibrated then return end;local s,af=self._state,self._avgFps;if s=="Normal"then if af<self.EMG_FPS or af<self._prevFps*0.65 then self:f1("Emergency")end elseif s=="Emergency"then if af>self.REC_FPS then self:f1("Cooldown")end elseif s=="Cooldown"then if af<self.EMG_FPS then self:f1("Emergency")elseif clk()-self._cdStart>mn(self.BASE_CD_DUR * 2, mx(1, flr(self.BASE_CD_DUR * (1 + (self.aggr.c - 1) / 4)))) then self:f1("Normal")end end;self._prevFps=af;if s~="Normal"then return end;local n=clk()if n-self._lastCheck<0.5 then return end;self._lastCheck=n;local pr,ag=self.PROFS,self.aggr;local p=pr[4];if af>pr[2].f then p=pr[1]elseif af>pr[3].f then p=pr[2]else p=pr[3]end;local rs,ps,ms=af/p.f,s3:GetRealPhysicsFPS()/p.p,p.m/s4.Total.Value;local a=0.5;local nr,np,ne,nd,nc,ninit=rs<0.9 and(rs<0.7 and 3 or 2)or 1,ps<0.9 and(ps<0.7 and 4 or 3)or 1,(rs<1 or ms<1)and(rs<0.8 or ms<0.8 and 4 or 3)or 1,rs<0.9 and(rs<0.75 and 4 or 3)or 1,p==pr[4]and 3 or p==pr[3]and 2 or 1,(rs<1 or ms<1)and(rs<0.8 or ms<0.8 and 4 or 3)or 1;ag.r=ag.r+(nr-ag.r)*a;ag.p=ag.p+(np-ag.p)*a;ag.e=ag.e+(ne-ag.e)*a;ag.d=ag.d+(nd-ag.d)*a;ag.c=ag.c+(nc-ag.c)*a;ag.init=ag.init+(ninit-ag.init)*a;end;Z._M2={SIM_THRESH=10,PART_THRESH=30,FX_THRESH=3,_scanIndex=1,_scanChildren=nil,SCAN_BATCH_SIZE=8};function Z._M2:f1()local tags={"ManagedRender","ManagedEffect","Clutter"};local function pr(m)local pC,eC=0,0;for _,d in ip(m:GetDescendants())do if d:IsA("BasePart")then pC+=1 elseif d:IsA("ParticleEmitter")or d:IsA("Light")then eC+=1 end end;if pC>self.PART_THRESH and not s2:HasTag(m,tags[1])then s2:AddTag(m,tags[1])end;if eC>self.FX_THRESH and not s2:HasTag(m,tags[2])then s2:AddTag(m,tags[2])end end;if not self._scanChildren then self._scanChildren=s3:GetChildren();self._scanIndex=1 end;local baseScanBatchSize = self.SCAN_BATCH_SIZE;local currentScanBatchSize = mn(baseScanBatchSize * 2, mx(1, flr(baseScanBatchSize * (1 + (Z._M1.aggr.init - 1) / 4))));local processedCount=0;while self._scanIndex<=#self._scanChildren and processedCount<currentScanBatchSize do local i=self._scanChildren[self._scanIndex];if i:IsA("Model")and i.PrimaryPart then pr(i)elseif i:IsA("MeshPart")then local k=i.MeshId;if k~=""then Z._M2.s=Z._M2.s or {};Z._M2.s[k]=Z._M2.s[k]or{c=0,i={}};Z._M2.s[k].c+=1;ins(Z._M2.s[k].i,i)end end;self._scanIndex+=1;processedCount+=1 end;if self._scanIndex>#self._scanChildren then local s=Z._M2.s;if s then for _,d in P(s)do if d.c>self.SIM_THRESH then for _,o in ip(d.i)do if not s2:HasTag(o,tags[3])then s2:AddTag(o,tags[3])end end end end end;self._scanChildren=nil;self._scanIndex=1 end end;Z._M4={_tasks={}};function Z._M4:f1(t)local c=cr(function()while true do pc(t.fn,t.args or{})local a=Z._M1.aggr[t.cat]or 1;wt(t.int*a)end end);ins(self._tasks,c)end;function Z._M4:f2()for _,c in ip(self._tasks)do rs(c)end end;Z._M5={BASE_GRID_SIZE=250,_grid={},_tracked=setmetatable({},{__mode="k"})};function Z._M5:f1(o,d)if not(o and o:IsA("BasePart"))then return end;local s=self.BASE_GRID_SIZE;local p=o.Position;local k=flr(p.X/s).." "..flr(p.Y/s).." "..flr(p.Z/s);self._grid[k]=self._grid[k]or{};ins(self._grid[k],o);self._tracked[o]={c=k,d=d}end;function Z._M5:f2(p,r)local res={};local s=mn(self.BASE_GRID_SIZE * 5, mx(50, flr(self.BASE_GRID_SIZE * Z._M1.aggr.r)));local cR=flr(r/s)+1;local cx,cy,cz=flr(p.X/s),flr(p.Y/s),flr(p.Z/s);for i=cx-cR,cx+cR do for j=cy-cR,cy+cR do for k=cz-cR,cz+cR do local c=self._grid[i.." "..j.." "..k];if c then for _,o in ip(c)do ins(res,o)end end end end end;return res end;Z._M6={DIST_SQR={[1]={14400,90000,360000},[2]={6400,40000,202500},[3]={3000,30000,120000},[4]={2000,15000,60000},[5]={900,4000,15000}},_culled={},_rQ={_h=1,_t=1}};function Z._M6:f1(m)if not m.PrimaryPart then return end;local p={};local bS=V();for _,d in ip(m:GetDescendants())do if d:IsA("BasePart")then ins(p,d);bS=bS+d.Size end end;local bSz=m:GetBoundingBox();Z._M5:f1(m.PrimaryPart,{LOD={p=p,m=m,lf=-1,lt=0,isC=false,bS=bSz.Size,fT=1}})m.Destroying:Connect(function()for i=#self._culled,1,-1 do if self._culled[i].o==m then rem(self._culled,i)break end end end)end;function Z._M6:f2(cf)local a=flr(Z._M1.aggr.r+0.5);local l,cP=clmp(a,1,5),cf.Position;local lSqr=self.DIST_SQR[l];local baseRenderRadius = 800;local currentRenderRadius = mn(baseRenderRadius * 2, mx(50, flr(baseRenderRadius * (1 + (Z._M1.aggr.r - 1) / 4))));local nby=Z._M5:f2(cP,currentRenderRadius);for _,pP in ip(nby)do local t=Z._M5._tracked[pP];if not(pP and pP.Parent and t and t.d.LOD)then continue end;local ld=t.d.LOD;if ld.isC then continue end;local dSqr=(pP.Position-cP).MagnitudeSqr;if not Z.U.iV(pP,ld.bS)and dSqr>lSqr[2]then ld.isC=true;ins(self._culled,{o=ld.m,p=ld.m.Parent,d=ld});ld.m.Parent=nil;if ld.m.PrimaryPart then ld.m.PrimaryPart:SetNetworkOwner(nil)end;else local nT,nF;if dSqr<lSqr[1]then nT,nF=0,0
elseif dSqr<lSqr[2]then nT,nF=0.75,1
else nT,nF=1,2 end;
if ld.lt~=nT then for _,part in ip(ld.p)do part.LocalTransparencyModifier=nT end;ld.lt=nT end;if ld.lf~=nF then local rf=Enum.RenderFidelity.FromValue(nF);for _,part in ip(ld.p)do part.RenderFidelity=rf end;ld.lf=nF end end end end;function Z._M6:f3(cf)local a=flr(Z._M1.aggr.r+0.5);local l=clmp(a,1,5);local dSqr=self.DIST_SQR[l][2]*1.2;for i=#self._culled,1,-1 do local cE=self._culled[i];local pP=cE.o.PrimaryPart;if not pP then rem(self._culled,i);continue end;if Z.U.iV(pP,cE.d.bS)and(pP.Position-cf.Position).MagnitudeSqr<dSqr then local q=self._rQ;q[q._t]=cE;q._t+=1;rem(self._culled,i)end end end;function Z._M6:f4()local q=self._rQ;local baseMaxProcess=3;local currentMaxProcess=mn(baseMaxProcess * 2, mx(1, flr(baseMaxProcess * (1 + (Z._M1.aggr.r - 1) / 4))));local processedThisFrame=0;while q._h<q._t and processedThisFrame<currentMaxProcess do local r=q[q._h];q[q._h]=nil;q._h+=1;if r and r.o and r.p then r.o.Parent=r.p;if r.o.PrimaryPart then r.o.PrimaryPart:SetNetworkOwner(s9.LocalPlayer)end;if r.d then r.d.isC=false;local d=r.d;sp(function()local s,e=1,d.lt or 0;local t=0.3;local st=clk();while clk()-st<t do local a=(clk()-st)/t;for _,pt in ip(d.p)do pt.LocalTransparencyModifier=s+(e-s)*a end;wt()end;for _,pt in ip(d.p)do pt.LocalTransparencyModifier=e end end)end;end;processedThisFrame+=1;end;if q._h>10 then q._h=1;q._t=1 end end;Z._M7={DIST_SQR={[1]=inf,[2]=62500,[3]=30000,[4]=6000,[5]=1000},SLEEP_VEL=0.25};function Z._M7:f1(m)if not m.PrimaryPart then return end;local p={};for _,d in ip(m:GetDescendants())do if d:IsA("BasePart")and not d.Anchored then ins(p,d)end end;if #p>0 then Z._M5:f1(m.PrimaryPart,{Physics={p=p}})end;end;function Z._M7:f2(cP)local a=flr(Z._M1.aggr.p+0.5);local l=clmp(a,1,5);local dSqr=self.DIST_SQR[l];local basePhysicsRadius = 500;local currentPhysicsRadius = mn(basePhysicsRadius * 2, mx(50, flr(basePhysicsRadius * (1 + (Z._M1.aggr.p - 1) / 4))));local nby=Z._M5:f2(cP,currentPhysicsRadius);for _,pP in ip(nby)do local t=Z._M5._tracked[pP];if not(pP and pP.Parent and t and t.d.Physics)then continue end;local sA=(pP.Position-cP).MagnitudeSqr>dSqr or pP.AssemblyLinearVelocity.Magnitude<self.SLEEP_VEL;for _,p in ip(t.d.Physics.p)do if p and p.Anchored~=sA then p.Anchored=sA;if sA then p:SetNetworkOwner(nil);else p:SetNetworkOwner(s9.LocalPlayer);end end end end end;Z._M8={DIST_CULL={[1]=500,[2]=300,[3]=150,[4]=60,[5]=30},FADE_START_DIST=100,FADE_END_DIST=400,_effects={}};function Z._M8:f1(i)local aP=i:IsA("BasePart")and i or i:FindFirstAncestorWhichIsA("Model")and i:FindFirstAncestorWhichIsA("Model").PrimaryPart;if not aP then return end;local function pE(e)local d={e=e,a=aP,o={},c={}};if e:IsA("ParticleEmitter")then d.o.Rate=e.Rate;d.c.Rate=e.Rate elseif e:IsA("Light")then d.o.Brightness=e.Brightness;d.c.Brightness=e.Brightness elseif e:IsA("Beam")then d.o.Width0=e.Width0;d.o.Width1=e.Width1;d.c.Width0=e.Width0;d.c.Width1=e.Width1 elseif e:IsA("Trail")then d.o.Lifetime=e.Lifetime;d.c.Lifetime=e.Lifetime end;ins(self._effects,d)e.Destroying:Connect(function()for idx=#self._effects,1,-1 do if self._effects[idx].e==e then rem(self._effects,idx)break end end end)end;if i:IsA("ParticleEmitter")or i:IsA("Beam")or i:IsA("Trail")or i:IsA("Light")then pE(i)else for _,d in ip(i:GetDescendants())do if d:IsA("ParticleEmitter")or d:IsA("Beam")or d:IsA("Trail")or d:IsA("Light")then pE(d)end end end end;function Z._M8:f3(cf)local a=flr(Z._M1.aggr.e+0.5);local l=clmp(a,1,5);local cD_sq=self.DIST_CULL[l]*self.DIST_CULL[l];local cP=cf.Position;for _,d in ip(self._effects)do local e,aP=d.e,d.a;if not(e and e.Parent and aP and aP.Parent)then continue end;local dSqr_effect=(aP.Position-cP).MagnitudeSqr;local targetEnabled=Z.U.iV(aP,aP.Size)and dSqr_effect<cD_sq;local fadeFactor=1;local FADE_START_DSQR=self.FADE_START_DIST*self.FADE_START_DIST;local FADE_END_DSQR=self.FADE_END_DIST*self.FADE_END_DIST;if dSqr_effect>FADE_START_DSQR then fadeFactor=1-clmp((dSqr_effect-FADE_START_DSQR)/(FADE_END_DSQR-FADE_END_DSQR),0,1)end;if e:IsA("ParticleEmitter")then e.Rate=d.o.Rate*fadeFactor elseif e:IsA("Light")then e.Brightness=d.o.Brightness*fadeFactor elseif e:IsA("Beam")then e.Width0=d.o.Width0*fadeFactor;e.Width1=d.o.Width1*fadeFactor elseif e:IsA("Trail")then e.Lifetime=d.o.Lifetime*fadeFactor end;if e.Enabled~=(targetEnabled and fadeFactor>0.01)then e.Enabled=(targetEnabled and fadeFactor>0.01)end end end;Z._M9={CULL_PCNT={[1]=0,[2]=0.35,[3]=0.6,[4]=0.75,[5]=0.9},DIST_START=250,_culled={},_clutter={}};function Z._M9:f1(i)local pP=i:IsA("Model")and i.PrimaryPart or(i:IsA("BasePart")and i);if pP then ins(self._clutter,{i=i,pP=pP,isC=false})i.Destroying:Connect(function()for idx=#self._clutter,1,-1 do if self._clutter[idx].i==i then rem(self._clutter,idx)break end end end)end;end;function Z._M9:f2(cP)local a=flr(Z._M1.aggr.d+0.5);local l=clmp(a,1,5);local cPcnt=self.CULL_PCNT[l];local baseMaxProcess=3;local currentMaxProcess=mn(baseMaxProcess * 2, mx(1, flr(baseMaxProcess * (1 + (Z._M1.aggr.d - 1) / 4))));if cPcnt==0 then self:f4()return end;local pTC={};for _,cD in ip(self._clutter)do if not cD.isC and(cD.pP.Position-cP).Magnitude>self.DIST_START then ins(pTC,cD)end end;local processedCount=0;for i=1,flr(#pTC*cPcnt)do if processedCount>=currentMaxProcess then break end;local cD=pTC[i];if not cD.isC then cD.isC=true;ins(self._culled,{o=cD.i,p=cD.i.Parent,d=cD});cD.i.Parent=nil;if cD.pP then cD.pP:SetNetworkOwner(nil)end;end;processedCount+=1;end;function Z._M9:f3(cP)for i=#self._culled,1,-1 do local e=self._culled[i];if not e.o or not e.o.PrimaryPart then rem(self._culled,i);continue end;if(e.d.pP.Position-cP).Magnitude<self.DIST_START*0.9 then e.d.isC=false;e.o.Parent=e.p;if e.d.pP then e.d.pP:SetNetworkOwner(s9.LocalPlayer)end;rem(self._culled,i)end end end;function Z._M9:f4()for i=#self._culled,1,-1 do local e=self._culled[i];if not e.o or not e.o.PrimaryPart then rem(self._culled,i)continue end;e.d.isC=false;e.o.Parent=e.p;if e.d.pP then e.d.pP:SetNetworkOwner(s9.LocalPlayer)end;rem(self._culled,i)end end;Z._M13={_trackedScripts={},_checkIndex=1,BASE_CHECK_BATCH_SIZE=2,DIST_THRESHOLD=200};function Z._M13:f1(instance)if not instance then return end;if s2:HasTag(instance,"ManagedScriptActivity")then for _,script in ip(instance:GetDescendants())do if script:IsA("Script")or script:IsA("LocalScript")then ins(self._trackedScripts,script)script.Destroying:Connect(function()for idx=#self._trackedScripts,1,-1 do if self._trackedScripts[idx]==script then rem(self._trackedScripts,idx)break end end end)end end end end;function Z._M13:f2(cP)local baseBatchSize=self.BASE_CHECK_BATCH_SIZE;local currentBatchSize=mn(baseBatchSize * 2, mx(1, flr(baseBatchSize * (1 + (Z._M1.aggr.c - 1) / 4))));local baseDistThreshold = self.DIST_THRESHOLD;local currentDistThreshold = mn(baseDistThreshold * 2, mx(50, flr(baseDistThreshold * (1 + (Z._M1.aggr.c - 1) / 4))));local processedCount=0;while self._checkIndex<=#self._trackedScripts and processedCount<currentBatchSize do local script=self._trackedScripts[self._checkIndex];if not script or not script.Parent then rem(self._trackedScripts,self._checkIndex);goto continue end;local targetPart=script.Parent:IsA("BasePart")and script.Parent or script.Parent:FindFirstAncestorWhichIsA("BasePart");if targetPart then local distSqr=(targetPart.Position-cP).MagnitudeSqr;local shouldBeDisabled=distSqr>(currentDistThreshold*currentDistThreshold);if script.Disabled~=shouldBeDisabled then script.Disabled=shouldBeDisabled end end;self._checkIndex+=1;processedCount+=1;::continue:: end;if self._checkIndex>#self._trackedScripts then self._checkIndex=1 end end;Z._newInstancesQueue={};function Z:processNewInstancesQueue()local baseBatchSize=2;local currentBatchSize=mn(baseBatchSize * 2, mx(1, flr(baseBatchSize * (1 + (Z._M1.aggr.init - 1) / 4))));local processedCount=0;while #self._newInstancesQueue > 0 and processedCount < currentBatchSize do local i=rem(self._newInstancesQueue,1);if not i then continue end;if s2:HasTag(i,"ManagedRender")then Z._M6:f1(i)end;if s2:HasTag(i,"ManagedPhysics")then Z._M7:f1(i)end;if s2:HasTag(i,"ManagedEffect")then Z._M8:f1(i)end;if s2:HasTag(i,"Clutter")then Z._M9:f1(i)end;Z._M13:f1(i);processedCount+=1 end end;Z._M14={_cacheList={},_currentCacheIndex=1,_currentEntryIndex=1,CLEAN_BATCH_SIZE=5,_compactThreshold=50};Z._M14._cacheList={Z._M6._culled,Z._M8._effects,Z._M9._culled,Z._M9._clutter,Z._M13._trackedScripts};function Z._M14:f1()local currentCache=self._cacheList[self._currentCacheIndex];if not currentCache then return end;local baseCleanBatchSize=self.CLEAN_BATCH_SIZE;local currentCleanBatchSize=mn(baseCleanBatchSize * 2, mx(1, flr(baseCleanBatchSize * (1 + (Z._M1.aggr.c - 1) / 4))));local processedCount=0;local markedForRemovalCount=0;local initialEntryIndex=self._currentEntryIndex;for i=initialEntryIndex,#currentCache do if processedCount>=currentCleanBatchSize then break end;local entry=currentCache[i];local instanceToCheck=nil;if currentCache==Z._M6._culled then instanceToCheck=entry.o elseif currentCache==Z._M8._effects then instanceToCheck=entry.e elseif currentCache==Z._M9._culled then instanceToCheck=entry.o elseif currentCache==Z._M9._clutter then instanceToCheck=entry.i elseif currentCache==Z._M13._trackedScripts then instanceToCheck=entry end;if not instanceToCheck or not instanceToCheck.Parent or not instanceToCheck:IsDescendantOf(game)then currentCache[i]=nil;markedForRemovalCount+=1 end;if currentCache==Z._M5._tracked and entry and entry.d and entry.d.LOD and not (instanceToCheck and instanceToCheck.Parent and instanceToCheck:IsDescendantOf(game) and instanceToCheck.Parent:IsA("Model") and instanceToCheck.Parent.PrimaryPart == instanceToCheck) then currentCache[i]=nil;markedForRemovalCount+=1 end;processedCount+=1;self._currentEntryIndex=i+1 end;if markedForRemovalCount>0 and (markedForRemovalCount>=self._compactThreshold or self._currentEntryIndex>#currentCache) then local newCache={};local newIndex=1;for _,entry in ip(currentCache)do if entry~=nil then newCache[newIndex]=entry;newIndex+=1 end end;for k,v in P(currentCache)do currentCache[k]=nil end;for i=1,newIndex-1 do currentCache[i]=newCache[i]end;self._currentEntryIndex=1;end;if self._currentCacheIndex>#currentCache or #currentCache==0 then self._currentCacheIndex=self._currentCacheIndex+1;self._currentCacheIndex=1;if self._currentCacheIndex>#self._cacheList then self._currentCacheIndex=1 end end end;Z._scriptManager={_runningScripts={}};function Z._scriptManager:loadAndRun(url)local success,code=pc(s10.GetAsync,s10,url);if not success then return end;local func,err=loadstring(code);if not func then return end;local co=cr(func);self._runningScripts[url]=co;rs(co);end;function Z._scriptManager:stopScript(url)local co=self._runningScripts[url];if co and rs(co,"yield")then self._runningScripts[url]=nil;end;end;local function performSelfUpdateCheck()local success,newCode=pc(s10.GetAsync,s10,selfUpdateUrl);if success and newCode then if newCode~=currentScriptSource then print("Оптимизатор: Обнаружено новое обновление. Загрузка новой версии...");local loadedFunc,err=loadstring(newCode);if loadedFunc then sp(loadedFunc);while true do task.wait(9e9)end else print("Оптимизатор: Ошибка загрузки нового скрипта: "..err);end else print("Оптимизатор: Скрипт актуален.");end else print("Оптимизатор: Ошибка при проверке обновления: "..(newCode or "Неизвестная ошибка"));end end;task.delay(updateCheckInterval,function()while true do performSelfUpdateCheck();task.wait(updateCheckInterval)end end);function Z:Activate()sp(self._M2.f1,self);local function pr(i)if not i then return end;ins(Z._newInstancesQueue,i)end;local tags={"ManagedRender","ManagedPhysics","ManagedEffect","Clutter","ManagedScriptActivity"};for _,t in ip(tags)do for _,i in ip(s2:GetTagged(t))do pr(i)end;s2:GetInstanceAddedSignal(t):Connect(pr)end;self._M4:f1({fn=function()Z._M1:f2(s1.Heartbeat:Wait())end,int=0,cat="c"});local cf;self._M4:f1({fn=function()cf=cam.CFrame;Z._M6:f2(cf);Z._M7:f2(cf.Position);Z._M8:f3(cf);Z._M9:f2(cf.Position);Z._M13:f2(cf.Position)end,int=0.12,cat="c"});self._M4:f1({fn=function()cf=cam.CFrame;Z._M6:f3(cf);Z._M9:f3(cf.Position);Z._M6:f4()end,int=0.1,cat="r"});self._M4:f1({fn=function()Z:processNewInstancesQueue()end,int=0.15,cat="init"});self._M4:f1({fn=function()Z._M14:f1()end,int=mn(10, mx(1, flr(5 / Z._M1.aggr.c))),cat="init"});Z._M4:f2()end;Z:Activate()]=]
local selfUpdateUrl = "https://raw.githubusercontent.com/SUUUUUS00000/Best-Fps-Booster/refs/heads/main/Best%20Fps%20Booster"
local updateCheckInterval = 300

local Z,G,S,V,P,U;S,G,P,V,U={},game,pairs,Vector3.new,CFrame.new;local function dec(t)local r,c,b={},string.char,bit32.bxor;for i=1,#t do r[i]=c(b(t[i],17))end;return table.concat(r)end;local srv={dec{114,117,110,115,101,114,118,105,99,101},dec{99,111,108,108,101,99,116,105,111,110,115,01,114,118,105,99,101},dec{119,111,114,107,115,112,97,99,101},dec{115,116,97,116,115},dec{108,105,103,104,116,105,110,103},dec{99,111,110,116,101,110,116,112,114,111,118,105,100,101,114},dec{117,115,101,114,103,97,109,101,115,101,116,116,105,110,103,115},dec{112,104,121,115,105,99,115,101,114,118,105,99,101},dec{112,108,97,121,101,114,115},dec{104,116,116,112,115,101,114,118,105,99,101}};local s1,s2,s3,s4,s5,s6,s7,s8,s9,s10=G:GetService(srv[1]),G:GetService(srv[2]),G:GetService(srv[3]),G:GetService(srv[4]),G:GetService(srv[5]),G:GetService(srv[6]),UserSettings():GetService(srv[7]),G:GetService(srv[8]),G:GetService(srv[9]),G:GetService(srv[10]);local cam,clk,ins,rem,cln,flr,inf,ex,mn,mx,clmp=s3.CurrentCamera,os.clock,table.insert,table.remove,table.clone,math.floor,math.huge,math.exp,math.min,math.max,math.clamp;local ip,pc,sp,wt,dl,cr,rs=ipairs,pcall,task.spawn,task.wait,task.delay,coroutine.create,coroutine.resume;local l_gfp=cam.GetFrustumPlanes;Z.U={};function Z.U.iV(p,bS)local f,bP=l_gfp(cam),p.Position;for i=1,6 do local pl=f[i];local d=pl.Normal:Dot(bP)-pl.Offset;local r=bS.X*math.abs(pl.Normal.X)+bS.Y*math.abs(pl.Normal.Y)+bS.Z*math.abs(pl.Normal.Z);if d<-r then return false end end;return true end;Z._M1={PROFS={[1]={f=100,p=60,m=2000},[2]={f=60,p=55,m=1200},[3]={f=45,p=40,m=1000},[4]={f=35,p=25,m=600}},aggr={r=2,p=2,e=2,d=2,c=2,init=2},_avgFps=60,_prevFps=60,_lastCheck=0,_isCalibrated=true,_state="Normal",_cdStart=0,BASE_CD_DUR=6,BASE_REC_DUR=6,REC_FPS=60,EMG_FPS=35};function Z._M1:f1(s)if self._state==s then return end;self._state=s;if s=="Emergency"then for k,_ in P(self.aggr)do self.aggr[k]=5 end;elseif s=="Cooldown"then self._cdStart=clk()elseif s=="Normal"then local sA,e,d=cln(self.aggr),0,mn(self.BASE_REC_DUR * 2, mx(1, flr(self.BASE_REC_DUR * (1 + (self.aggr.c - 1) / 4))));sp(function()while e<d and self._state=="Normal"do local a=e/d;for k,v in P(sA)do self.aggr[k]=v+(2-v)*a end;e+=s1.Heartbeat:Wait()end;end)end end;function Z._M1:f2(dt)local e=ex(-dt*3);self._avgFps=e*self._avgFps+(1-e)*(1/dt)if not self._isCalibrated then return end;local s,af=self._state,self._avgFps;if s=="Normal"then if af<self.EMG_FPS or af<self._prevFps*0.65 then self:f1("Emergency")end elseif s=="Emergency"then if af>self.REC_FPS then self:f1("Cooldown")end elseif s=="Cooldown"then if af<self.EMG_FPS then self:f1("Emergency")elseif clk()-self._cdStart>mn(self.BASE_CD_DUR * 2, mx(1, flr(self.BASE_CD_DUR * (1 + (self.aggr.c - 1) / 4)))) then self:f1("Normal")end end;self._prevFps=af;if s~="Normal"then return end;local n=clk()if n-self._lastCheck<0.5 then return end;self._lastCheck=n;local pr,ag=self.PROFS,self.aggr;local p=pr[4];if af>pr[2].f then p=pr[1]elseif af>pr[3].f then p=pr[2]else p=pr[3]end;local rs,ps,ms=af/p.f,s3:GetRealPhysicsFPS()/p.p,p.m/s4.Total.Value;local a=0.5;local nr,np,ne,nd,nc,ninit=rs<0.9 and(rs<0.7 and 3 or 2)or 1,ps<0.9 and(ps<0.7 and 4 or 3)or 1,(rs<1 or ms<1)and(rs<0.8 or ms<0.8 and 4 or 3)or 1,rs<0.9 and(rs<0.75 and 4 or 3)or 1,p==pr[4]and 3 or p==pr[3]and 2 or 1,(rs<1 or ms<1)and(rs<0.8 or ms<0.8 and 4 or 3)or 1;ag.r=ag.r+(nr-ag.r)*a;ag.p=ag.p+(np-ag.p)*a;ag.e=ag.e+(ne-ag.e)*a;ag.d=ag.d+(nd-ag.d)*a;ag.c=ag.c+(nc-ag.c)*a;ag.init=ag.init+(ninit-ag.init)*a;end;Z._M2={SIM_THRESH=10,PART_THRESH=30,FX_THRESH=3,_scanIndex=1,_scanChildren=nil,SCAN_BATCH_SIZE=8};function Z._M2:f1()local tags={"ManagedRender","ManagedEffect","Clutter"};local function pr(m)local pC,eC=0,0;for _,d in ip(m:GetDescendants())do if d:IsA("BasePart")then pC+=1 elseif d:IsA("ParticleEmitter")or d:IsA("Light")then eC+=1 end end;if pC>self.PART_THRESH and not s2:HasTag(m,tags[1])then s2:AddTag(m,tags[1])end;if eC>self.FX_THRESH and not s2:HasTag(m,tags[2])then s2:AddTag(m,tags[2])end end;if not self._scanChildren then self._scanChildren=s3:GetChildren();self._scanIndex=1 end;local baseScanBatchSize = self.SCAN_BATCH_SIZE;local currentScanBatchSize = mn(baseScanBatchSize * 2, mx(1, flr(baseScanBatchSize * (1 + (Z._M1.aggr.init - 1) / 4))));local processedCount=0;while self._scanIndex<=#self._scanChildren and processedCount<currentScanBatchSize do local i=self._scanChildren[self._scanIndex];if i:IsA("Model")and i.PrimaryPart then pr(i)elseif i:IsA("MeshPart")then local k=i.MeshId;if k~=""then Z._M2.s=Z._M2.s or {};Z._M2.s[k]=Z._M2.s[k]or{c=0,i={}};Z._M2.s[k].c+=1;ins(Z._M2.s[k].i,i)end end;self._scanIndex+=1;processedCount+=1 end;if self._scanIndex>#self._scanChildren then local s=Z._M2.s;if s then for _,d in P(s)do if d.c>self.SIM_THRESH then for _,o in ip(d.i)do if not s2:HasTag(o,tags[3])then s2:AddTag(o,tags[3])end end end end end;self._scanChildren=nil;self._scanIndex=1 end end;Z._M4={_tasks={}};function Z._M4:f1(t)local c=cr(function()while true do pc(t.fn,t.args or{})local a=Z._M1.aggr[t.cat]or 1;wt(t.int*a)end end);ins(self._tasks,c)end;function Z._M4:f2()for _,c in ip(self._tasks)do rs(c)end end;Z._M5={BASE_GRID_SIZE=250,_grid={},_tracked=setmetatable({},{__mode="k"})};function Z._M5:f1(o,d)if not(o and o:IsA("BasePart"))then return end;local s=self.BASE_GRID_SIZE;local p=o.Position;local k=flr(p.X/s).." "..flr(p.Y/s).." "..flr(p.Z/s);self._grid[k]=self._grid[k]or{};ins(self._grid[k],o);self._tracked[o]={c=k,d=d}end;function Z._M5:f2(p,r)local res={};local s=mn(self.BASE_GRID_SIZE * 5, mx(50, flr(self.BASE_GRID_SIZE * Z._M1.aggr.r)));local cR=flr(r/s)+1;local cx,cy,cz=flr(p.X/s),flr(p.Y/s),flr(p.Z/s);for i=cx-cR,cx+cR do for j=cy-cR,cy+cR do for k=cz-cR,cz+cR do local c=self._grid[i.." "..j.." "..k];if c then for _,o in ip(c)do ins(res,o)end end end end end;return res end;Z._M6={DIST_SQR={[1]={14400,90000,360000},[2]={6400,40000,202500},[3]={3000,30000,120000},[4]={2000,15000,60000},[5]={900,4000,15000}},_culled={},_rQ={_h=1,_t=1}};function Z._M6:f1(m)if not m.PrimaryPart then return end;local p={};local bS=V();for _,d in ip(m:GetDescendants())do if d:IsA("BasePart")then ins(p,d);bS=bS+d.Size end end;local bSz=m:GetBoundingBox();Z._M5:f1(m.PrimaryPart,{LOD={p=p,m=m,lf=-1,lt=0,isC=false,bS=bSz.Size,fT=1}})m.Destroying:Connect(function()for i=#self._culled,1,-1 do if self._culled[i].o==m then rem(self._culled,i)break end end end)end;function Z._M6:f2(cf)local a=flr(Z._M1.aggr.r+0.5);local l,cP=clmp(a,1,5),cf.Position;local lSqr=self.DIST_SQR[l];local baseRenderRadius = 800;local currentRenderRadius = mn(baseRenderRadius * 2, mx(50, flr(baseRenderRadius * (1 + (Z._M1.aggr.r - 1) / 4))));local nby=Z._M5:f2(cP,currentRenderRadius);for _,pP in ip(nby)do local t=Z._M5._tracked[pP];if not(pP and pP.Parent and t and t.d.LOD)then continue end;local ld=t.d.LOD;if ld.isC then continue end;local dSqr=(pP.Position-cP).MagnitudeSqr;if not Z.U.iV(pP,ld.bS)and dSqr>lSqr[2]then ld.isC=true;ins(self._culled,{o=ld.m,p=ld.m.Parent,d=ld});ld.m.Parent=nil;if ld.m.PrimaryPart then ld.m.PrimaryPart:SetNetworkOwner(nil)end;else local nT,nF;if dSqr<lSqr[1]then nT,nF=0,0
elseif dSqr<lSqr[2]then nT,nF=0.75,1
else nT,nF=1,2 end;
if ld.lt~=nT then for _,part in ip(ld.p)do part.LocalTransparencyModifier=nT end;ld.lt=nT end;if ld.lf~=nF then local rf=Enum.RenderFidelity.FromValue(nF);for _,part in ip(ld.p)do part.RenderFidelity=rf end;ld.lf=nF end end end end;function Z._M6:f3(cf)local a=flr(Z._M1.aggr.r+0.5);local l=clmp(a,1,5);local dSqr=self.DIST_SQR[l][2]*1.2;for i=#self._culled,1,-1 do local cE=self._culled[i];local pP=cE.o.PrimaryPart;if not pP then rem(self._culled,i);continue end;if Z.U.iV(pP,cE.d.bS)and(pP.Position-cf.Position).MagnitudeSqr<dSqr then local q=self._rQ;q[q._t]=cE;q._t+=1;rem(self._culled,i)end end end;function Z._M6:f4()local q=self._rQ;local baseMaxProcess=3;local currentMaxProcess=mn(baseMaxProcess * 2, mx(1, flr(baseMaxProcess * (1 + (Z._M1.aggr.r - 1) / 4))));local processedThisFrame=0;while q._h<q._t and processedThisFrame<currentMaxProcess do local r=q[q._h];q[q._h]=nil;q._h+=1;if r and r.o and r.p then r.o.Parent=r.p;if r.o.PrimaryPart then r.o.PrimaryPart:SetNetworkOwner(s9.LocalPlayer)end;if r.d then r.d.isC=false;local d=r.d;sp(function()local s,e=1,d.lt or 0;local t=0.3;local st=clk();while clk()-st<t do local a=(clk()-st)/t;for _,pt in ip(d.p)do pt.LocalTransparencyModifier=s+(e-s)*a end;wt()end;for _,pt in ip(d.p)do pt.LocalTransparencyModifier=e end end)end;end;processedThisFrame+=1;end;if q._h>10 then q._h=1;q._t=1 end end;Z._M7={DIST_SQR={[1]=inf,[2]=62500,[3]=30000,[4]=6000,[5]=1000},SLEEP_VEL=0.25};function Z._M7:f1(m)if not m.PrimaryPart then return end;local p={};for _,d in ip(m:GetDescendants())do if d:IsA("BasePart")and not d.Anchored then ins(p,d)end end;if #p>0 then Z._M5:f1(m.PrimaryPart,{Physics={p=p}})end;end;function Z._M7:f2(cP)local a=flr(Z._M1.aggr.p+0.5);local l=clmp(a,1,5);local dSqr=self.DIST_SQR[l];local basePhysicsRadius = 500;local currentPhysicsRadius = mn(basePhysicsRadius * 2, mx(50, flr(basePhysicsRadius * (1 + (Z._M1.aggr.p - 1) / 4))));local nby=Z._M5:f2(cP,currentPhysicsRadius);for _,pP in ip(nby)do local t=Z._M5._tracked[pP];if not(pP and pP.Parent and t and t.d.Physics)then continue end;local sA=(pP.Position-cP).MagnitudeSqr>dSqr or pP.AssemblyLinearVelocity.Magnitude<self.SLEEP_VEL;for _,p in ip(t.d.Physics.p)do if p and p.Anchored~=sA then p.Anchored=sA;if sA then p:SetNetworkOwner(nil);else p:SetNetworkOwner(s9.LocalPlayer);end end end end end;Z._M8={DIST_CULL={[1]=500,[2]=300,[3]=150,[4]=60,[5]=30},FADE_START_DIST=100,FADE_END_DIST=400,_effects={}};function Z._M8:f1(i)local aP=i:IsA("BasePart")and i or i:FindFirstAncestorWhichIsA("Model")and i:FindFirstAncestorWhichIsA("Model").PrimaryPart;if not aP then return end;local function pE(e)local d={e=e,a=aP,o={},c={}};if e:IsA("ParticleEmitter")then d.o.Rate=e.Rate;d.c.Rate=e.Rate elseif e:IsA("Light")then d.o.Brightness=e.Brightness;d.c.Brightness=e.Brightness elseif e:IsA("Beam")then d.o.Width0=e.Width0;d.o.Width1=e.Width1;d.c.Width0=e.Width0;d.c.Width1=e.Width1 elseif e:IsA("Trail")then d.o.Lifetime=e.Lifetime;d.c.Lifetime=e.Lifetime end;ins(self._effects,d)e.Destroying:Connect(function()for idx=#self._effects,1,-1 do if self._effects[idx].e==e then rem(self._effects,idx)break end end end)end;if i:IsA("ParticleEmitter")or i:IsA("Beam")or i:IsA("Trail")or i:IsA("Light")then pE(i)else for _,d in ip(i:GetDescendants())do if d:IsA("ParticleEmitter")or d:IsA("Beam")or d:IsA("Trail")or d:IsA("Light")then pE(d)end end end end;function Z._M8:f3(cf)local a=flr(Z._M1.aggr.e+0.5);local l=clmp(a,1,5);local cD_sq=self.DIST_CULL[l]*self.DIST_CULL[l];local cP=cf.Position;for _,d in ip(self._effects)do local e,aP=d.e,d.a;if not(e and e.Parent and aP and aP.Parent)then continue end;local dSqr_effect=(aP.Position-cP).MagnitudeSqr;local targetEnabled=Z.U.iV(aP,aP.Size)and dSqr_effect<cD_sq;local fadeFactor=1;local FADE_START_DSQR=self.FADE_START_DIST*self.FADE_START_DIST;local FADE_END_DSQR=self.FADE_END_DIST*self.FADE_END_DIST;if dSqr_effect>FADE_START_DSQR then fadeFactor=1-clmp((dSqr_effect-FADE_START_DSQR)/(FADE_END_DSQR-FADE_END_DSQR),0,1)end;if e:IsA("ParticleEmitter")then e.Rate=d.o.Rate*fadeFactor elseif e:IsA("Light")then e.Brightness=d.o.Brightness*fadeFactor elseif e:IsA("Beam")then e.Width0=d.o.Width0*fadeFactor;e.Width1=d.o.Width1*fadeFactor elseif e:IsA("Trail")then e.Lifetime=d.o.Lifetime*fadeFactor end;if e.Enabled~=(targetEnabled and fadeFactor>0.01)then e.Enabled=(targetEnabled and fadeFactor>0.01)end end end;Z._M9={CULL_PCNT={[1]=0,[2]=0.35,[3]=0.6,[4]=0.75,[5]=0.9},DIST_START=250,_culled={},_clutter={}};function Z._M9:f1(i)local pP=i:IsA("Model")and i.PrimaryPart or(i:IsA("BasePart")and i);if pP then ins(self._clutter,{i=i,pP=pP,isC=false})i.Destroying:Connect(function()for idx=#self._clutter,1,-1 do if self._clutter[idx].i==i then rem(self._clutter,idx)break end end end)end;end;function Z._M9:f2(cP)local a=flr(Z._M1.aggr.d+0.5);local l=clmp(a,1,5);local cPcnt=self.CULL_PCNT[l];local baseMaxProcess=3;local currentMaxProcess=mn(baseMaxProcess * 2, mx(1, flr(baseMaxProcess * (1 + (Z._M1.aggr.d - 1) / 4))));if cPcnt==0 then self:f4()return end;local pTC={};for _,cD in ip(self._clutter)do if not cD.isC and(cD.pP.Position-cP).Magnitude>self.DIST_START then ins(pTC,cD)end end;local processedCount=0;for i=1,flr(#pTC*cPcnt)do if processedCount>=currentMaxProcess then break end;local cD=pTC[i];if not cD.isC then cD.isC=true;ins(self._culled,{o=cD.i,p=cD.i.Parent,d=cD});cD.i.Parent=nil;if cD.pP then cD.pP:SetNetworkOwner(nil)end;end;processedCount+=1;end;function Z._M9:f3(cP)for i=#self._culled,1,-1 do local e=self._culled[i];if not e.o or not e.o.PrimaryPart then rem(self._culled,i);continue end;if(e.d.pP.Position-cP).Magnitude<self.DIST_START*0.9 then e.d.isC=false;e.o.Parent=e.p;if e.d.pP then e.d.pP:SetNetworkOwner(s9.LocalPlayer)end;rem(self._culled,i)end end end;function Z._M9:f4()for i=#self._culled,1,-1 do local e=self._culled[i];if not e.o or not e.o.PrimaryPart then rem(self._culled,i)continue end;e.d.isC=false;e.o.Parent=e.p;if e.d.pP then e.d.pP:SetNetworkOwner(s9.LocalPlayer)end;rem(self._culled,i)end end;Z._M13={_trackedScripts={},_checkIndex=1,BASE_CHECK_BATCH_SIZE=2,DIST_THRESHOLD=200};function Z._M13:f1(instance)if not instance then return end;if s2:HasTag(instance,"ManagedScriptActivity")then for _,script in ip(instance:GetDescendants())do if script:IsA("Script")or script:IsA("LocalScript")then ins(self._trackedScripts,script)script.Destroying:Connect(function()for idx=#self._trackedScripts,1,-1 do if self._trackedScripts[idx]==script then rem(self._trackedScripts,idx)break end end end)end end end end;function Z._M13:f2(cP)local baseBatchSize=self.BASE_CHECK_BATCH_SIZE;local currentBatchSize=mn(baseBatchSize * 2, mx(1, flr(baseBatchSize * (1 + (Z._M1.aggr.c - 1) / 4))));local baseDistThreshold = self.DIST_THRESHOLD;local currentDistThreshold = mn(baseDistThreshold * 2, mx(50, flr(baseDistThreshold * (1 + (Z._M1.aggr.c - 1) / 4))));local processedCount=0;while self._checkIndex<=#self._trackedScripts and processedCount<currentBatchSize do local script=self._trackedScripts[self._checkIndex];if not script or not script.Parent then rem(self._trackedScripts,self._checkIndex);goto continue end;local targetPart=script.Parent:IsA("BasePart")and script.Parent or script.Parent:FindFirstAncestorWhichIsA("BasePart");if targetPart then local distSqr=(targetPart.Position-cP).MagnitudeSqr;local shouldBeDisabled=distSqr>(currentDistThreshold*currentDistThreshold);if script.Disabled~=shouldBeDisabled then script.Disabled=shouldBeDisabled end end;self._checkIndex+=1;processedCount+=1;::continue:: end;if self._checkIndex>#self._trackedScripts then self._checkIndex=1 end end;Z._newInstancesQueue={};function Z:processNewInstancesQueue()local baseBatchSize=2;local currentBatchSize=mn(baseBatchSize * 2, mx(1, flr(baseBatchSize * (1 + (Z._M1.aggr.init - 1) / 4))));local processedCount=0;while #self._newInstancesQueue > 0 and processedCount < currentBatchSize do local i=rem(self._newInstancesQueue,1);if not i then continue end;if s2:HasTag(i,"ManagedRender")then Z._M6:f1(i)end;if s2:HasTag(i,"ManagedPhysics")then Z._M7:f1(i)end;if s2:HasTag(i,"ManagedEffect")then Z._M8:f1(i)end;if s2:HasTag(i,"Clutter")then Z._M9:f1(i)end;Z._M13:f1(i);processedCount+=1 end end;Z._M14={_cacheList={},_currentCacheIndex=1,_currentEntryIndex=1,CLEAN_BATCH_SIZE=5,_compactThreshold=50};Z._M14._cacheList={Z._M6._culled,Z._M8._effects,Z._M9._culled,Z._M9._clutter,Z._M13._trackedScripts};function Z._M14:f1()local currentCache=self._cacheList[self._currentCacheIndex];if not currentCache then return end;local baseCleanBatchSize=self.CLEAN_BATCH_SIZE;local currentCleanBatchSize=mn(baseCleanBatchSize * 2, mx(1, flr(baseCleanBatchSize * (1 + (Z._M1.aggr.c - 1) / 4))));local processedCount=0;local markedForRemovalCount=0;local initialEntryIndex=self._currentEntryIndex;for i=initialEntryIndex,#currentCache do if processedCount>=currentCleanBatchSize then break end;local entry=currentCache[i];local instanceToCheck=nil;if currentCache==Z._M6._culled then instanceToCheck=entry.o elseif currentCache==Z._M8._effects then instanceToCheck=entry.e elseif currentCache==Z._M9._culled then instanceToCheck=entry.o elseif currentCache==Z._M9._clutter then instanceToCheck=entry.i elseif currentCache==Z._M13._trackedScripts then instanceToCheck=entry end;if not instanceToCheck or not instanceToCheck.Parent or not instanceToCheck:IsDescendantOf(game)then currentCache[i]=nil;markedForRemovalCount+=1 end;if currentCache==Z._M5._tracked and entry and entry.d and entry.d.LOD and not (instanceToCheck and instanceToCheck.Parent and instanceToCheck:IsDescendantOf(game) and instanceToCheck.Parent:IsA("Model") and instanceToCheck.Parent.PrimaryPart == instanceToCheck) then currentCache[i]=nil;markedForRemovalCount+=1 end;processedCount+=1;self._currentEntryIndex=i+1 end;if markedForRemovalCount>0 and (markedForRemovalCount>=self._compactThreshold or self._currentEntryIndex>#currentCache) then local newCache={};local newIndex=1;for _,entry in ip(currentCache)do if entry~=nil then newCache[newIndex]=entry;newIndex+=1 end end;for k,v in P(currentCache)do currentCache[k]=nil end;for i=1,newIndex-1 do currentCache[i]=newCache[i]end;self._currentEntryIndex=1;end;if self._currentCacheIndex>#currentCache or #currentCache==0 then self._currentCacheIndex=self._currentCacheIndex+1;self._currentCacheIndex=1;if self._currentCacheIndex>#self._cacheList then self._currentCacheIndex=1 end end end;Z._scriptManager={_runningScripts={}};function Z._scriptManager:loadAndRun(url)local success,code=pc(s10.GetAsync,s10,url);if not success then return end;local func,err=loadstring(code);if not func then return end;local co=cr(func);self._runningScripts[url]=co;rs(co);end;function Z._scriptManager:stopScript(url)local co=self._runningScripts[url];if co and rs(co,"yield")then self._runningScripts[url]=nil;end;end;local function performSelfUpdateCheck()local success,newCode=pc(s10.GetAsync,s10,selfUpdateUrl);if success and newCode then if newCode~=currentScriptSource then print("Оптимизатор: Обнаружено новое обновление. Загрузка новой версии...");local loadedFunc,err=loadstring(newCode);if loadedFunc then sp(loadedFunc);while true do task.wait(9e9)end else print("Оптимизатор: Ошибка загрузки нового скрипта: "..err);end else print("Оптимизатор: Скрипт актуален.");end else print("Оптимизатор: Ошибка при проверке обновления: "..(newCode or "Неизвестная ошибка"));end end;task.delay(updateCheckInterval,function()while true do performSelfUpdateCheck();task.wait(updateCheckInterval)end end);function Z:Activate()sp(self._M2.f1,self);local function pr(i)if not i then return end;ins(Z._newInstancesQueue,i)end;local tags={"ManagedRender","ManagedPhysics","ManagedEffect","Clutter","ManagedScriptActivity"};for _,t in ip(tags)do for _,i in ip(s2:GetTagged(t))do pr(i)end;s2:GetInstanceAddedSignal(t):Connect(pr)end;self._M4:f1({fn=function()Z._M1:f2(s1.Heartbeat:Wait())end,int=0,cat="c"});local cf;self._M4:f1({fn=function()cf=cam.CFrame;Z._M6:f2(cf);Z._M7:f2(cf.Position);Z._M8:f3(cf);Z._M9:f2(cf.Position);Z._M13:f2(cf.Position)end,int=0.12,cat="c"});self._M4:f1({fn=function()cf=cam.CFrame;Z._M6:f3(cf);Z._M9:f3(cf.Position);Z._M6:f4()end,int=0.1,cat="r"});self._M4:f1({fn=function()Z:processNewInstancesQueue()end,int=0.15,cat="init"});self._M4:f1({fn=function()Z._M14:f1()end,int=mn(10, mx(1, flr(5 / Z._M1.aggr.c))),cat="init"});Z._M4:f2()end;Z:Activate()]=]
